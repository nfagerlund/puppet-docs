<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Puppet::Functions
  
    &mdash; Documentation by YARD 0.9.0
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Puppet::Functions";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (F)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Puppet.html" title="Puppet (module)">Puppet</a></span></span>
     &raquo; 
    <span class="title">Functions</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="../class_list.html"></iframe>

      <div id="content"><h1>Module: Puppet::Functions
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/puppet/functions.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
  <div class="note todo">
    <strong>TODO:</strong>
    <div class='inline'><p>Documentation for individual instances of these new functions is not
yet tied into the puppet doc system.</p>
</div>
  </div>

<p>Functions in the puppet language can be written in Ruby and distributed in
puppet modules. The function is written by creating a file in the module&#39;s
<code>lib/puppet/functions/&lt;modulename&gt;</code> directory, where <code>&lt;modulename&gt;</code> is
replaced with the module&#39;s name. The file should have the name of the function.
For example, to create a function named <code>min</code> in a module named <code>math</code> create
a file named <code>lib/puppet/functions/math/min.rb</code> in the module.</p>

<p>A function is implemented by calling <span class='object_link'><a href="#create_function-class_method" title="Puppet::Functions.create_function (method)">Functions.create_function</a></span>, and
passing it a block that defines the implementation of the function.</p>

<p>Functions are namespaced inside the module that contains them. The name of
the function is prefixed with the name of the module. For example,
<code>math::min</code>.</p>

<h2>Anatomy of a function</h2>

<p>Functions are composed of four parts: the name, the implementation methods,
the signatures, and the dispatches.</p>

<p>The name is the string given to the <span class='object_link'><a href="#create_function-class_method" title="Puppet::Functions.create_function (method)">Functions.create_function</a></span>
method. It specifies the name to use when calling the function in the puppet
language, or from other functions.</p>

<p>The implementation methods are ruby methods (there can be one or more) that
provide that actual implementation of the function&#39;s behavior. In the
simplest case the name of the function (excluding any namespace) and the name
of the method are the same. When that is done no other parts (signatures and
dispatches) need to be used.</p>

<p>Signatures are a way of specifying the types of the function&#39;s parameters.
The types of any arguments will be checked against the types declared in the
signature and an error will be produced if they don&#39;t match. The types are
defined by using the same syntax for types as in the puppet language.</p>

<p>Dispatches are how signatures and implementation methods are tied together.
When the function is called, puppet searches the signatures for one that
matches the supplied arguments. Each signature is part of a dispatch, which
specifies the method that should be called for that signature. When a
matching signature is found, the corrosponding method is called.</p>

<p>Documentation for the function should be placed as comments to the
implementation method(s).</p>

<h2>Specifying Signatures</h2>

<p>If nothing is specified, the number of arguments given to the function must
be the same as the number of parameters, and all of the parameters are of
type &#39;Any&#39;.</p>

<p>The following methods can be used to define a parameter</p>

<ul>
<li><em>param</em> - the argument must be given in the call.</li>
<li><em>optional_param</em> - the argument may be missing in the call. May not be followed by a required parameter</li>
<li><em>repeated_param</em> - the type specifies a repeating type that occurs 0 to &quot;infinite&quot; number of times. It may only appear last or just before a block parameter.</li>
<li><em>block_param</em> - a block must be given in the call. May only appear last.</li>
<li><em>optional_block_param</em> - a block may be given in the call. May only appear last.</li>
</ul>

<p>The method name <em>required_param</em> is an alias for <em>param</em> and <em>required_block_param</em> is an alias for <em>block_param</em></p>

<p>A parameter definition takes 2 arguments:</p>

<ul>
<li><em>type</em> A string that must conform to a type in the puppet language</li>
<li><em>name</em> A symbol denoting the parameter name</li>
</ul>

<p>Both arguments are optional when defining a block parameter. The <em>type</em> defaults to &quot;Callable&quot;
and the <em>name</em> to :block.</p>

<p>Note that the dispatch definition is used to match arguments given in a call to the function with the defined
parameters. It then dispatches the call to the implementation method simply passing the given arguments on to
that method without any further processing and it is the responsibility of that method&#39;s implementor to ensure
that it can handle those arguments.</p>

<p>There is no requirement for direct mapping between parameter definitions and the parameters in the
receiving implementation method so the following example is also legal. Here the dispatch will ensure
that <code>*values</code> in the receiver will be an array with at least one entry of type String and that any
remaining entries are of type Numeric:</p>

<h2>Access to Scope</h2>

<p>In general, functions should not need access to scope; they should be
written to act on their given input only. If they absolutely must look up
variable values, they should do so via the closure scope (the scope where
they are defined) - this is done by calling <code>closure_scope()</code>.</p>

<h2>Calling other Functions</h2>

<p>Calling other functions by name is directly supported via
<span class='object_link'><a href="Pops/Functions/Function.html#call_function-instance_method" title="Puppet::Pops::Functions::Function#call_function (method)">Pops::Functions::Function#call_function</a></span>. This allows a function to
call other functions visible from its loader.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>A simple function</p>
</div></p>
      
      <pre class="example code"><code><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Functions</span><span class='period'>.</span><span class='id identifier rubyid_create_function'>create_function</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>math::min</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_min'>min</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>?</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>:</span> <span class='id identifier rubyid_b'>b</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Dispatching to different methods by type</p>
</div></p>
      
      <pre class="example code"><code><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Functions</span><span class='period'>.</span><span class='id identifier rubyid_create_function'>create_function</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>math::min</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_dispatch'>dispatch</span> <span class='symbol'>:numeric_min</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_param'>param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Numeric</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:a</span>
    <span class='id identifier rubyid_param'>param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Numeric</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:b</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_dispatch'>dispatch</span> <span class='symbol'>:string_min</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_param'>param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>String</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:a</span>
    <span class='id identifier rubyid_param'>param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>String</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:b</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_numeric_min'>numeric_min</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>?</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>:</span> <span class='id identifier rubyid_b'>b</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_string_min'>string_min</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span> <span class='op'>?</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>:</span> <span class='id identifier rubyid_b'>b</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Variable number of arguments</p>
</div></p>
      
      <pre class="example code"><code><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Functions</span><span class='period'>.</span><span class='id identifier rubyid_create_function'>create_function</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_dispatch'>dispatch</span> <span class='symbol'>:foo</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_param'>param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Numeric</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:first</span>
    <span class='id identifier rubyid_repeated_param'>repeated_param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Numeric</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:values</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_foo'>foo</span><span class='lparen'>(</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
    <span class='comment'># do something
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
      
        <p class="example_title"><div class='inline'><p>Inexact mapping or parameters</p>
</div></p>
      
      <pre class="example code"><code><span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Functions</span><span class='period'>.</span><span class='id identifier rubyid_create_function'>create_function</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_dispatch'>dispatch</span> <span class='symbol'>:foo</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_param'>param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>String</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:first</span>
    <span class='id identifier rubyid_repeated_param'>repeated_param</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Numeric</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:values</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_foo'>foo</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
    <span class='comment'># do something
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Functions/DispatcherBuilder.html" title="Puppet::Functions::DispatcherBuilder (class)">DispatcherBuilder</a></span>, <span class='object_link'><a href="Functions/Function.html" title="Puppet::Functions::Function (class)">Function</a></span>, <span class='object_link'><a href="Functions/InternalDispatchBuilder.html" title="Puppet::Functions::InternalDispatchBuilder (class)">InternalDispatchBuilder</a></span>, <span class='object_link'><a href="Functions/InternalFunction.html" title="Puppet::Functions::InternalFunction (class)">InternalFunction</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#any_signature-class_method" title="any_signature (class method)">.<strong>any_signature</strong>(from, to, names)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'><p>Construct a signature consisting of Object type, with min, and max, and given names.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#create_function-class_method" title="create_function (class method)">.<strong>create_function</strong>(func_name, function_base = Function, &amp;block)  &#x21d2; Class&lt;Function&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The newly created Function class.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#create_loaded_function-class_method" title="create_loaded_function (class method)">.<strong>create_loaded_function</strong>(func_name, loader, function_base = Function, &amp;block)  &#x21d2; Class&lt;Function&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a function in, or in a local loader under the given loader.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#default_dispatcher-class_method" title="default_dispatcher (class method)">.<strong>default_dispatcher</strong>(the_class, func_name)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'><p>Creates a default dispatcher configured from a method with the same name as the function.</p>
</div></span>
  
</li>

      
        
<li class="public ">
  <span class="summary_signature">
    
      <a href="#min_max_param-class_method" title="min_max_param (class method)">.<strong>min_max_param</strong>(method)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  
  <span class="private note title">private</span>

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="any_signature-class_method">
  
    .<strong>any_signature</strong>(from, to, names)  &#x21d2; <tt><span class='object_link'>Object</span></tt> &nbsp;<span class="private note title">private</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>
<p>Construct a signature consisting of Object type, with min, and max, and given names.
(there is only one type entry).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


258
259
260
261
262
263</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/functions.rb', line 258</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_any_signature'>any_signature</span><span class='lparen'>(</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='comma'>,</span> <span class='id identifier rubyid_names'>names</span><span class='rparen'>)</span>
  <span class='comment'># Construct the type for the signature
</span>  <span class='comment'># Tuple[Object, from, to]
</span>  <span class='id identifier rubyid_factory'>factory</span> <span class='op'>=</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Pops</span><span class='op'>::</span><span class='const'>Types</span><span class='op'>::</span><span class='const'>TypeFactory</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_factory'>factory</span><span class='period'>.</span><span class='id identifier rubyid_callable'>callable</span><span class='lparen'>(</span><span class='id identifier rubyid_factory'>factory</span><span class='period'>.</span><span class='id identifier rubyid_any'>any</span><span class='comma'>,</span> <span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_names'>names</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_function-class_method">
  
    .<strong>create_function</strong>(func_name, function_base = Function, &amp;block)  &#x21d2; <tt><span class='object_link'>Class</span>&lt;<span class='object_link'><a href="Functions/Function.html" title="Puppet::Functions::Function (class)">Function</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the newly created Function class</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>func_name</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt><span class='object_link'>Symbol</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a simple or qualified function name</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the block that defines the methods and dispatch of the
Function to create</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'>Class</span>&lt;<span class='object_link'><a href="Functions/Function.html" title="Puppet::Functions::Function (class)">Function</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the newly created Function class</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/functions.rb', line 155</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_function'>create_function</span><span class='lparen'>(</span><span class='id identifier rubyid_func_name'>func_name</span><span class='comma'>,</span> <span class='id identifier rubyid_function_base'>function_base</span> <span class='op'>=</span> <span class='const'>Function</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='comment'># Ruby &lt; 2.1.0 does not have method on Binding, can only do eval
</span>  <span class='comment'># and it will fail unless protected with an if defined? if the local
</span>  <span class='comment'># variable does not exist in the block&#39;s binder.
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_loader'>loader</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_binding'>binding</span><span class='period'>.</span><span class='id identifier rubyid_eval'>eval</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>loader_injected_arg if defined?(loader_injected_arg)</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_create_loaded_function'>create_loaded_function</span><span class='lparen'>(</span><span class='id identifier rubyid_func_name'>func_name</span><span class='comma'>,</span> <span class='id identifier rubyid_loader'>loader</span><span class='comma'>,</span> <span class='id identifier rubyid_function_base'>function_base</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_loaded_function-class_method">
  
    .<strong>create_loaded_function</strong>(func_name, loader, function_base = Function, &amp;block)  &#x21d2; <tt><span class='object_link'>Class</span>&lt;<span class='object_link'><a href="Functions/Function.html" title="Puppet::Functions::Function (class)">Function</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a function in, or in a local loader under the given loader.
This method should only be used when manually creating functions 
for the sake of testing. Functions that are autoloaded should
always use the <code>create_function</code> method and the autoloader will supply
the correct loader.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>func_name</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt><span class='object_link'>Symbol</span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a simple or qualified function name</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>loader</span>
      
      
        <span class='type'>(<tt>Puppet::Pops::Loaders::Loader</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the loader loading the function</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the block that defines the methods and dispatch of the
Function to create</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'>Class</span>&lt;<span class='object_link'><a href="Functions/Function.html" title="Puppet::Functions::Function (class)">Function</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the newly created Function class</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/functions.rb', line 177</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create_loaded_function'>create_loaded_function</span><span class='lparen'>(</span><span class='id identifier rubyid_func_name'>func_name</span><span class='comma'>,</span> <span class='id identifier rubyid_loader'>loader</span><span class='comma'>,</span> <span class='id identifier rubyid_function_base'>function_base</span> <span class='op'>=</span> <span class='const'>Function</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_function_base'>function_base</span><span class='period'>.</span><span class='id identifier rubyid_ancestors'>ancestors</span><span class='period'>.</span><span class='id identifier rubyid_none?'>none?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>==</span> <span class='const'>Puppet</span><span class='op'>::</span><span class='const'>Pops</span><span class='op'>::</span><span class='const'>Functions</span><span class='op'>::</span><span class='const'>Function</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Functions must be based on Puppet::Pops::Functions::Function. Got </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_function_base'>function_base</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_func_name'>func_name</span> <span class='op'>=</span> <span class='id identifier rubyid_func_name'>func_name</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='comment'># Creates an anonymous class to represent the function
</span>  <span class='comment'># The idea being that it is garbage collected when there are no more
</span>  <span class='comment'># references to it.
</span>  <span class='comment'>#
</span>  <span class='comment'># (Do not give the class the block here, as instance variables should be set first)
</span>  <span class='id identifier rubyid_the_class'>the_class</span> <span class='op'>=</span> <span class='const'>Class</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_function_base'>function_base</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_loader'>loader</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_the_class'>the_class</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@loader</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_loader'>loader</span><span class='period'>.</span><span class='id identifier rubyid_private_loader'>private_loader</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Make the anonymous class appear to have the class-name &lt;func_name&gt;
</span>  <span class='comment'># Even if this class is not bound to such a symbol in a global ruby scope and
</span>  <span class='comment'># must be resolved via the loader.
</span>  <span class='comment'># This also overrides any attempt to define a name method in the given block
</span>  <span class='comment'># (Since it redefines it)
</span>  <span class='comment'>#
</span>  <span class='comment'># TODO, enforce name in lower case (to further make it stand out since Ruby
</span>  <span class='comment'># class names are upper case)
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_the_class'>the_class</span><span class='period'>.</span><span class='id identifier rubyid_instance_eval'>instance_eval</span> <span class='kw'>do</span>
    <span class='ivar'>@func_name</span> <span class='op'>=</span> <span class='id identifier rubyid_func_name'>func_name</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_name'>name</span>
      <span class='ivar'>@func_name</span>
    <span class='kw'>end</span>

    <span class='kw'>def</span> <span class='id identifier rubyid_loader'>loader</span>
      <span class='ivar'>@loader</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># The given block can now be evaluated and have access to name and loader
</span>  <span class='comment'>#
</span>  <span class='id identifier rubyid_the_class'>the_class</span><span class='period'>.</span><span class='id identifier rubyid_class_eval'>class_eval</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>

  <span class='comment'># Automatically create an object dispatcher based on introspection if the
</span>  <span class='comment'># loaded user code did not define any dispatchers. Fail if function name
</span>  <span class='comment'># does not match a given method name in user code.
</span>  <span class='comment'>#
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_the_class'>the_class</span><span class='period'>.</span><span class='id identifier rubyid_dispatcher'>dispatcher</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_simple_name'>simple_name</span> <span class='op'>=</span> <span class='id identifier rubyid_func_name'>func_name</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>::</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_names'>names</span> <span class='op'>=</span> <span class='id identifier rubyid_default_dispatcher'>default_dispatcher</span><span class='lparen'>(</span><span class='id identifier rubyid_the_class'>the_class</span><span class='comma'>,</span> <span class='id identifier rubyid_simple_name'>simple_name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_last_captures_rest'>last_captures_rest</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='period'>.</span><span class='id identifier rubyid_size_range'>size_range</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='const'>Float</span><span class='op'>::</span><span class='const'>INFINITY</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_the_class'>the_class</span><span class='period'>.</span><span class='id identifier rubyid_dispatcher'>dispatcher</span><span class='period'>.</span><span class='id identifier rubyid_add_dispatch'>add_dispatch</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_simple_name'>simple_name</span><span class='comma'>,</span> <span class='id identifier rubyid_names'>names</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_last_captures_rest'>last_captures_rest</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># The function class is returned as the result of the create function method
</span>  <span class='id identifier rubyid_the_class'>the_class</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_dispatcher-class_method">
  
    .<strong>default_dispatcher</strong>(the_class, func_name)  &#x21d2; <tt><span class='object_link'>Object</span></tt> &nbsp;<span class="private note title">private</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>
<p>Creates a default dispatcher configured from a method with the same name as the function</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/functions.rb', line 237</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_default_dispatcher'>default_dispatcher</span><span class='lparen'>(</span><span class='id identifier rubyid_the_class'>the_class</span><span class='comma'>,</span> <span class='id identifier rubyid_func_name'>func_name</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_the_class'>the_class</span><span class='period'>.</span><span class='id identifier rubyid_method_defined?'>method_defined?</span><span class='lparen'>(</span><span class='id identifier rubyid_func_name'>func_name</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Function Creation Error, cannot create a default dispatcher for function &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_func_name'>func_name</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;, no method with this name found</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_any_signature'>any_signature</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_min_max_param'>min_max_param</span><span class='lparen'>(</span><span class='id identifier rubyid_the_class'>the_class</span><span class='period'>.</span><span class='id identifier rubyid_instance_method'>instance_method</span><span class='lparen'>(</span><span class='id identifier rubyid_func_name'>func_name</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="min_max_param-class_method">
  
    .<strong>min_max_param</strong>(method)  &#x21d2; <tt><span class='object_link'>Object</span></tt> &nbsp;<span class="private note title">private</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note private">
  <strong>This method is part of a private API.</strong>
  You should avoid using this method if possible, as it may be removed or be changed in the future.
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


245
246
247
248
249
250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/puppet/functions.rb', line 245</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_min_max_param'>min_max_param</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='symbol'>:req</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:opt</span> <span class='op'>=&gt;</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:rest</span> <span class='op'>=&gt;</span> <span class='int'>0</span> <span class='rbrace'>}</span>
  <span class='comment'># count per parameter kind, and get array of names
</span>  <span class='id identifier rubyid_names'>names</span> <span class='op'>=</span> <span class='id identifier rubyid_method'>method</span><span class='period'>.</span><span class='id identifier rubyid_parameters'>parameters</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='semicolon'>;</span> <span class='id identifier rubyid_p'>p</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_from'>from</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:req</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_to'>to</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:rest</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='symbol'>:default</span> <span class='op'>:</span> <span class='id identifier rubyid_from'>from</span> <span class='op'>+</span> <span class='id identifier rubyid_result'>result</span><span class='lbracket'>[</span><span class='symbol'>:opt</span><span class='rbracket'>]</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_from'>from</span><span class='comma'>,</span> <span class='id identifier rubyid_to'>to</span><span class='comma'>,</span> <span class='id identifier rubyid_names'>names</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Jul  7 12:40:29 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.0 (ruby-2.0.0).
</div>

    </div>
  </body>
</html>